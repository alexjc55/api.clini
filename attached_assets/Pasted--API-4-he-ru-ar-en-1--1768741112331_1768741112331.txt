# Техническое задание

## Доработка текущего API для поддержки 4 языков (he, ru, ar, en)

---

## 1. Цель

Целью данной доработки является внедрение корректной, масштабируемой и безопасной архитектуры мультиязычности (i18n) в существующее API с поддержкой следующих языков:

* **Иврит** — `he`
* **Русский** — `ru`
* **Арабский** — `ar`
* **Английский** — `en`

Решение должно быть спроектировано таким образом, чтобы в будущем можно было добавлять новые языки **без изменений бизнес-логики API**.

---

## 2. Ключевые принципы (ОБЯЗАТЕЛЬНО)

1. ❗ **В коде API запрещено использование захардкоженного пользовательского текста** (ошибки, уведомления, статусы, описания).
2. API **не формирует UI-тексты**, а работает с ключами локализации.
3. Форматирование текста, дат, валют, чисел и плюрализация выполняются **на стороне клиента**.
4. Архитектура должна корректно поддерживать **RTL-языки** (he, ar).
5. API должно использовать **единый механизм определения языка**.

---

## 3. Определение языка запроса

### 3.1 Основной механизм

Язык определяется через стандартный HTTP-заголовок:

```
Accept-Language: he | ru | ar | en
```

### 3.2 Fallback-логика

Если:

* заголовок отсутствует
* язык не поддерживается

➡ используется fallback язык: **`en`**.

Язык должен быть доступен во всех слоях обработки запроса (middleware / context).

---

## 4. Формат ответов API (i18n-совместимый)

### 4.1 Ответы с ошибками и статусами

❌ **Запрещено**:

```json
{
  "error": "Order not found"
}
```

✅ **Разрешено и обязательно**:

```json
{
  "error": {
    "key": "order.not_found",
    "params": {
      "orderId": 123
    }
  }
}
```

Где:

* `key` — ключ локализации
* `params` — параметры для подстановки на клиенте

---

### 4.2 Успешные ответы

```json
{
  "status": "success",
  "message": {
    "key": "order.created",
    "params": {
      "orderId": 456
    }
  }
}
```

---

## 5. Работа с данными (строгие требования)

### 5.1 Даты и время

API **обязано** возвращать даты только в ISO 8601:

```json
"createdAt": "2026-01-12T10:30:00Z"
```

Форматирование по локали выполняется на клиенте (`he-IL`, `ru-RU`, `ar`, `en-US`).

---

### 5.2 Деньги и числа

❌ Запрещено:

```json
"price": "₪25"
```

✅ Обязательно:

```json
"price": 25,
"currency": "ILS"
```

---

### 5.3 Плюрализация

API **не решает** вопросы склонений и форм слов.

API передаёт **только числовые значения**, клиент самостоятельно выбирает форму текста.

---

## 6. RTL-совместимость (he / ar)

### Обязательные требования:

* API **не склеивает строки**
* API **не формирует предложения динамически**
* Порядок слов определяется исключительно на клиенте

❌ Запрещено:

```
"message": "Order " + orderId + " created"
```

✅ Разрешено:

```
key: "order.created"
params: { orderId }
```

---

## 7. Централизованный каталог ключей

Все ключи сообщений должны быть:

* уникальными
* иерархическими
* документированными

Пример структуры:

```
order.created
order.not_found
auth.invalid_code
payment.failed
```

Каталог ключей должен вестись централизованно и использоваться всеми командами.

---

## 8. Где API МОЖЕТ возвращать локализованный текст (исключения)

Локализованный текст **допускается только** для:

* Email
* Push-уведомлений
* SMS
* PDF / документы

В этих случаях:

* язык обязателен
* текст берётся из i18n-хранилища
* fallback язык — `en`

---

## 9. Расширяемость

Добавление нового языка должно требовать:

* добавления словаря переводов
* **без изменения API-контрактов**
* **без изменения бизнес-логики**

---

## 10. Критерии приёмки

* ❗ В коде отсутствует захардкоженный пользовательский текст
* Все ответы API используют `key + params`
* Корректная работа с `Accept-Language`
* Поддержка RTL без ошибок отображения
* Успешное добавление нового языка без изменений API

---

## 11. Примечание

Любое отклонение от данного ТЗ (включая добавление текста напрямую в код) считается архитектурной ошибкой и подлежит обязательному исправлению.
